<app-header></app-header>

<ion-content>
  <div class="caja-container">
    <div class="page-header">
      <h1>Caja Vecina</h1>
      <p>Gestión de transacciones bancarias</p>
    </div>

    <!-- Saldos -->
    <div class="balances-section">
      <div class="balance-card primary">
        <div class="balance-content">
          <ion-icon name="business-outline" class="balance-icon"></ion-icon>
          <div class="balance-info">
            <span class="balance-label">Saldo Caja Vecina</span>
            <span class="balance-amount">{{ saldoCajaVecinaActual | currency:'CLP':'symbol-narrow':'1.0-0' }}</span>
          </div>
        </div>
      </div>

      <div class="balance-card secondary">
        <div class="balance-content">
          <ion-icon name="wallet-outline" class="balance-icon"></ion-icon>
          <div class="balance-info">
            <span class="balance-label">Efectivo Disponible</span>
            <span class="balance-amount">{{ efectivoActual | currency:'CLP':'symbol-narrow':'1.0-0' }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Selector de transacción -->
    <div class="transaction-selector">
      <button
        class="segment-btn"
        [class.active]="tipoTransaccion === 'giro'"
        (click)="tipoTransaccion = 'giro'">
        <ion-icon name="arrow-up-circle-outline"></ion-icon>
        <span>Giro</span>
      </button>
      <button
        class="segment-btn"
        [class.active]="tipoTransaccion === 'deposito'"
        (click)="tipoTransaccion = 'deposito'">
        <ion-icon name="arrow-down-circle-outline"></ion-icon>
        <span>Depósito</span>
      </button>
      <button
        class="segment-btn"
        [class.active]="tipoTransaccion === 'pago'"
        (click)="tipoTransaccion = 'pago'">
        <ion-icon name="card-outline"></ion-icon>
        <span>Pago/Recarga</span>
      </button>
    </div>

    <!-- Formulario de transacción -->
    <div class="content-card">
      <h2 class="section-title">
        {{ tipoTransaccion === 'giro' ? 'Nuevo Giro' : tipoTransaccion === 'deposito' ? 'Nuevo Depósito' : 'Nuevo Pago/Recarga' }}
      </h2>

      <div class="transaction-form">
        <div class="form-field">
          <label>Monto</label>
          <div class="input-wrapper">
            <span class="currency-symbol">$</span>
            <input
              type="number"
              placeholder="0"
              [(ngModel)]="monto"
              (keyup.enter)="procesarTransaccion()">
          </div>
        </div>

        <div class="form-field" *ngIf="tipoTransaccion === 'pago'">
          <label>Método de Pago</label>
          <div class="payment-methods">
            <button
              class="method-btn"
              [class.active]="metodoPago === 'efectivo'"
              (click)="metodoPago = 'efectivo'">
              <ion-icon name="cash-outline"></ion-icon>
              <span>Efectivo</span>
            </button>
            <button
              class="method-btn"
              [class.active]="metodoPago === 'tarjeta'"
              (click)="metodoPago = 'tarjeta'">
              <ion-icon name="card-outline"></ion-icon>
              <span>Tarjeta</span>
            </button>
          </div>
        </div>

        <button
          class="btn-process"
          [class.giro]="tipoTransaccion === 'giro'"
          [class.deposito]="tipoTransaccion === 'deposito'"
          [class.pago]="tipoTransaccion === 'pago'"
          (click)="procesarTransaccion()"
          [disabled]="!monto || monto <= 0 || (tipoTransaccion === 'pago' && !metodoPago)">
          <ion-icon [name]="getIconoBoton()"></ion-icon>
          {{ getTextoBoton() }}
        </button>
      </div>
    </div>

    <!-- Historial -->
    <div class="content-card history-card" *ngIf="historialCajaVecina.length > 0">
      <div class="history-header">
        <ion-icon name="business-outline" class="history-icon"></ion-icon>
        <h2 class="section-title">Historial del Día</h2>
      </div>

      <div class="history-list">
        <div class="history-item" *ngFor="let transaccion of historialCajaVecina">
          <div class="item-icon" [ngClass]="transaccion.tipo_trans">
            <ion-icon [name]="getIconoTransaccion(transaccion.tipo_trans)"></ion-icon>
          </div>
          <div class="item-info">
            <div class="item-header">
              <div>
                <span class="item-type">{{ getTituloTransaccion(transaccion) }}</span>
                <span class="payment-method" *ngIf="transaccion.tipo_trans === 'pago'">
                  <ion-icon [name]="transaccion.metodo_pago === 'efectivo' ? 'cash-outline' : 'card-outline'"></ion-icon>
                  {{ transaccion.metodo_pago }}
                </span>
              </div>
              <span class="item-amount" [ngClass]="{
                'negative': getColorMonto(transaccion) === 'danger',
                'positive': getColorMonto(transaccion) === 'success',
                'neutral': getColorMonto(transaccion) === 'medium'
              }">
                {{ getSignoMonto(transaccion) }}{{ transaccion.monto | currency:'CLP':'symbol-narrow':'1.0-0' }}
              </span>
            </div>
            <div class="item-date">
              {{ formatearFecha(transaccion.fecha) }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <app-footer></app-footer>
</ion-content>
